# Premerge Checks ワークフロー

## 概要

Pull Requestに対して実行される統合テストとコード品質チェック

## トリガー

`main`ブランチへのPR作成・更新時

**実行条件**:
- mdファイルのみの変更の場合、テストジョブはスキップされる
- mdファイル以外が含まれる変更の場合、すべてのテストジョブが実行される

## ジョブ

| ジョブ | 説明 |
|-------|------|
| check-changes | `dorny/paths-filter`を使用して変更ファイルをチェックし、テスト実行の要否を判定 |
| unit-test | Lint、ビルド、ユニットテスト |
| backend-integration-test | バックエンド統合テスト |
| deploy-integration-test | CDKデプロイテスト |
| frontend-integration-test | フロントエンドE2Eテスト |
| e2e-test | エンドツーエンドテスト |

## E2Eテストレポートの管理

E2Eテストが実行されると、以下の処理が自動的に行われます：

1. **古いレポートの削除**: 新しいレポートをアップロードする前に、同名の古いArtifacts（`e2e-test-reports`）を削除します。最新の1つのみが保持されます。
2. **新しいレポートのアップロード**: テスト結果が新しいArtifactとしてアップロードされます（保持期間: 30日）。
3. **PRへのコメント**: レポートのダウンロード方法がPRにコメントとして投稿されます。
